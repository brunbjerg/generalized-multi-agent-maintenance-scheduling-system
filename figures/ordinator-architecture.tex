\usetikzlibrary {positioning}

\input{../../styles/colors.tex}

\newcommand{\ModelColor}{red}
\newcommand{\UserInterfaceColor}{yellow}
\newcommand{\PersistenceColor}{blue}
\newcommand{\PointerSwapColor}{green}
\newcommand{\OrchestratorColor}{other}

\newcommand{\basisinput}{4cm}  % Default value if not set by /graph/basis
\pgfkeys{
	/graph/.is family, /graph,
	default/.style = {
		show_shared_pointer = false,
		show_orchestrator = false,
		show_persistence = false,
		show_user_interface = false,
		basisinput/.estore in = \basisinput,
	},
	show_shared_pointer/.estore in = \ShowSharedSolutionCommunication,
	show_orchestrator/.estore in = \ShowOrchestratorCommunication,
	show_persistence/.estore in = \ShowPersistenceCommunication,
	show_user_interface/.estore in = \ShowUserInterfaceCommunication,
	basisinput/.estore in = \basisinput,
}

\newlength{\basis}
\tikzset{
  basis/.code={\setlength{\basis}{\basisinput}}, % TikZ assignment code
  basis/.default=3cm,                   % Provide a default (\b@sis is undefined/unassigned)
  basis,                                % Set initial Value (\b@sis is defined/assigned)
}

\newcommand{\drawGraph}[1]{
	\pgfkeys{/graph, default, #1}
	\setlength{\basis}{\basisinput}
	\begin{tikzpicture}[scale=0.75, line width=0.05\basis][

	]

		\ifthenelse{\equal{\ShowOrchestratorCommunication}{true}}{
			\draw[color=other,-, ultra thick] (Strategic) -- (Orchestrator);
			\draw[color=other,-, ultra thick] (Tactical) -- (Orchestrator);
			\draw[color=other,-, ultra thick] (Supervisor) -- (Orchestrator);
			\draw[color=other,-, ultra thick] (Operational_1) -- (Orchestrator);
			\draw[color=other,-, ultra thick] (Operational_2) -- (Orchestrator);
			\draw[color=other,-, ultra thick] (Operational_3) -- (Orchestrator);
		}{}
		% \draw[help lines] (0\basis, 0\basis) grid (10\basis, 8\basis);
		\draw (5\basis,4\basis) node[minimum height=5\basis,minimum width=7.0\basis,rounded corners=0.1\basis] {};

	    \draw[draw=black] (5.0\basis,4.0\basis) node[draw=black,minimum height=3.5\basis,minimum width=5\basis,rounded corners=0.1\basis] {} ;
	    \draw (2.5\basis,5.5\basis) node[minimum height=1\basis,minimum width=1\basis,fill=\ModelColor,rounded corners=0.1\basis] (Strategic) {Stra};
	    \draw (5.0\basis,4.0\basis) node[minimum height=1\basis,minimum width=1\basis,fill=\ModelColor,rounded corners=0.1\basis] (Supervisor) {Sup};
		\draw (7.5\basis,5.5\basis) node[minimum height=1\basis,minimum width=1\basis,fill=\ModelColor,rounded corners=0.1\basis] (Tactical) {Tac};

		\draw (2.5\basis,2.5\basis) node[minimum height=1\basis,minimum width=1\basis,fill=\ModelColor,rounded corners=0.1\basis] (Operational_1) {$O_{1}$};
		\draw (5.0\basis,2.5\basis) node[minimum height=1\basis,minimum width=1\basis,fill=\ModelColor,rounded corners=0.1\basis] (Operational_2) {$O_{2}$};
		\draw (7.5\basis,2.5\basis) node[minimum height=1\basis,minimum width=1\basis,fill=\ModelColor,rounded corners=0.1\basis,rounded corners=0.1\basis] (Operational_3) {$O_{3}$};
	
		\draw (Strategic) edge (Tactical);
		\draw (Strategic) edge (Tactical);
		\draw (5\basis,5.5\basis) edge (Supervisor);
		\draw (Supervisor) edge (Operational_1);
		\draw (Supervisor) edge (Operational_2);
		\draw (Supervisor) edge (Operational_3);
		\draw (5.0\basis,0.5\basis)   node[minimum height=1\basis,minimum width=5.0\basis,            fill=\PersistenceColor,rounded corners=0.1\basis] {persistence};
		\draw (5.0\basis,7.5\basis)   node[minimum height=1\basis,minimum width=5.0\basis,            fill=\OrchestratorColor,rounded corners=0.1\basis] (Orchestrator) {Orchestrator};
		\draw (0.5\basis,4.0\basis)   node[rotate=90, minimum height=1\basis, minimum width=3.5\basis,fill=\PointerSwapColor,rounded corners=0.1\basis] {decision variables};
		\draw (9.5\basis,5.75\basis)  node[rotate=90, minimum height=1\basis, minimum width=1\basis,fill=\UserInterfaceColor,rounded corners=0.1\basis] {UI};
		\draw (9.5\basis,4.0\basis)   node[rotate=90, minimum height=1\basis, minimum width=1\basis,fill=\UserInterfaceColor,rounded corners=0.1\basis] {UI};
		\draw (9.5\basis,2.25\basis)  node[rotate=90, minimum height=1\basis, minimum width=1\basis,fill=\UserInterfaceColor,rounded corners=0.1\basis] {UI};

		% Legend
		\begin{scope}[shift={(10.6\basis,5.7\basis)}]
			\node at (-0.25\basis,1\basis) [right] {Communication Type};
			\draw[color=\OrchestratorColor,fill] (0\basis,0.0\basis)   rectangle (0.5\basis, 0.5\basis);
			\node[anchor=west] at (0.5\basis, 0.25\basis) { Channels};
			\draw[color=\PointerSwapColor,fill] (0\basis,-1.0\basis)   rectangle(0.5\basis, -0.5\basis); 
			\node[anchor=west] at (0.5\basis, -0.75\basis) { Atomic Pointer Swap};
			\draw[color=\ModelColor,fill] (0\basis,-2.0\basis)         rectangle(0.5\basis, -1.5\basis); 
			\node[anchor=west] at (0.5\basis, -1.75\basis) { Metaheurics};
			\draw[color=\PersistenceColor,fill] (0\basis,-3.0\basis)   rectangle(0.5\basis, -2.5\basis); 
			\node[anchor=west] at (0.5\basis, -2.75\basis) { Mutex lock};
			\draw[color=\UserInterfaceColor,fill] (0\basis,-4.0\basis) rectangle(0.5\basis, -3.5\basis); 
			\node[anchor=west] at (0.5\basis, -3.75\basis) { Channels};
		\end{scope}
		\ifthenelse{\equal{\ShowSharedSolutionCommunication}{true}}{
			\draw[->, thick] (Strategic) -- (Orchestrator);
		}{}
		\ifthenelse{\equal{\ShowUserInterfaceCommunication}{true}}{
			\draw[->, thick] (Strategic) -- (Orchestrator);
		}{}
		\ifthenelse{\equal{\ShowPersistenceCommunication}{true}}{
			\draw[->, thick] (Strategic) -- (Orchestrator);
		}{}
		

	\end{tikzpicture}
}

